@page
@model GestionCentreDeFormation.Pages.Courses.DetailsModel

@{
    ViewData["Title"] = Model.Course.Title;
    
    // Image Logic
    string imgUrl = !string.IsNullOrEmpty(Model.Course.ImageUrl) 
        ? Model.Course.ImageUrl 
        : "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=1600&q=90"; // Higher quality default
    
    // Only use keyword fallback if no specific image is set
    if (string.IsNullOrEmpty(Model.Course.ImageUrl))
    {
        if (Model.Course.Title.Contains("REACT") || Model.Course.Title.Contains("JS")) imgUrl = "https://images.unsplash.com/photo-1633356122544-f134324a6cee?w=1600&q=90";
        else if (Model.Course.Title.Contains("UX") || Model.Course.Title.Contains("DESIGN")) imgUrl = "https://images.unsplash.com/photo-1561070791-2526d30994b5?w=1600&q=90";
        else if (Model.Course.Title.Contains("DEVOPS")) imgUrl = "https://images.unsplash.com/photo-1618401471353-b74a07ddcd5e?w=1600&q=90";
        else if (Model.Course.Title.Contains("CLOUD")) imgUrl = "https://images.unsplash.com/photo-1484557985045-edf25e08da73?w=1600&q=90";
        else if (Model.Course.Title.Contains("DATA")) imgUrl = "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1600&q=90";
        else if (Model.Course.Title.Contains("CYBER") || Model.Course.Title.Contains("SECURITY")) imgUrl = "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=1600&q=90";
        else if (Model.Course.Title.Contains("MOBILE") || Model.Course.Title.Contains("FLUTTER")) imgUrl = "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=1600&q=90";
    }
}

<style>
    .details-hero {
        position: relative;
        height: 500px; /* Increased height */
        border-bottom: 3px solid #000;
        overflow: hidden;
    }
    .details-hero-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.8); /* Slightly darken image itself */
    }
    .details-hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.2)); /* Better gradient */
        display: flex;
        align-items: flex-end;
        padding-bottom: 4rem;
    }
    .neo-breadcrumb {
        background: #fff;
        border: 2px solid #000;
        padding: 0.5rem 1rem;
        font-weight: 700;
        text-transform: uppercase;
        display: inline-block;
        margin-bottom: 1rem;
        box-shadow: 4px 4px 0px #000;
    }
    .neo-sidebar-card {
        background: #fff;
        border: 2px solid #000;
        box-shadow: 6px 6px 0px #000;
        padding: 2rem;
        position: sticky;
        top: 100px;
    }
    .neo-list-item {
        border-bottom: 2px solid #000;
        padding: 1rem 0;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .neo-list-item:last-child {
        border-bottom: none;
    }
    .check-icon {
        background: #000;
        color: #fff;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }
    .instructor-avatar {
        width: 80px;
        height: 80px;
        border: 2px solid #000;
        object-fit: cover;
    }
</style>

<!-- Hero Section -->
<div class="details-hero">
    <img src="@imgUrl" class="details-hero-img" alt="@Model.Course.Title">
    <div class="details-hero-overlay">
        <div class="container">
            <a asp-page="./Index" class="neo-breadcrumb text-decoration-none text-dark">
                <i class="bi bi-arrow-left me-2"></i> Back to Courses
            </a>
            <h1 class="display-3 fw-black text-white text-uppercase text-shadow-hard">@Model.Course.Title</h1>
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="row g-5">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Description -->
            <div class="mb-5">
                <h2 class="fw-bold text-uppercase border-bottom border-3 border-dark pb-2 mb-4">About This Course</h2>
                <p class="lead fw-medium">@Model.Course.Description</p>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
                    Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                </p>
            </div>

            <!-- What You'll Learn -->
            @if (!string.IsNullOrEmpty(Model.Course.WhatYoullLearn))
            {
                <div class="mb-5">
                    <h2 class="fw-bold text-uppercase border-bottom border-3 border-dark pb-2 mb-4">What You'll Learn</h2>
                    <div class="row g-3">
                        @foreach (var item in Model.Course.WhatYoullLearn.Split(new[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries))
                        {
                            <div class="col-md-6">
                                <div class="neo-list-item">
                                    <div class="check-icon"><i class="bi bi-check-lg"></i></div>
                                    <span class="fw-bold">@item</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Instructor -->
            @if (Model.Course.Instructor != null)
            {
                <div class="mb-5">
                    <h2 class="fw-bold text-uppercase border-bottom border-3 border-dark pb-2 mb-4">Your Instructor</h2>
                    <div class="d-flex gap-4 align-items-center bg-light border border-2 border-dark p-4">
                        @if (!string.IsNullOrEmpty(Model.Course.Instructor.ImageUrl))
                        {
                            <img src="@Model.Course.Instructor.ImageUrl" class="instructor-avatar" alt="@Model.Course.Instructor.Name">
                        }
                        else
                        {
                            <div class="instructor-avatar d-flex align-items-center justify-content-center bg-white fw-bold fs-3">
                                @Model.Course.Instructor.Name.Substring(0, 1)
                            </div>
                        }
                        <div>
                            <h4 class="fw-bold text-uppercase mb-1">@Model.Course.Instructor.Name</h4>
                            <p class="text-muted fw-bold small mb-2">@Model.Course.Instructor.Title</p>
                            <p class="mb-0 small">
                                @Model.Course.Instructor.Bio
                            </p>
                        </div>
                    </div>
                </div>
            }

            <!-- Admin Actions -->
            @if (User.IsInRole("Admin"))
            {
                <div class="mt-5 p-4 bg-warning border border-2 border-dark">
                    <h3 class="h5 fw-bold text-uppercase mb-3">Admin Controls</h3>
                    <div class="d-flex gap-3">
                        <a asp-page="./Edit" asp-route-id="@Model.Course.Id" class="btn btn-dark rounded-0 fw-bold px-4">EDIT COURSE</a>
                        <a asp-page="./Delete" asp-route-id="@Model.Course.Id" class="btn btn-danger rounded-0 fw-bold px-4 border border-dark">DELETE</a>
                    </div>
                </div>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="neo-sidebar-card">
                <div class="mb-4 pb-4 border-bottom border-2 border-dark">
                    <span class="d-block text-muted fw-bold text-uppercase small mb-1">Total Price</span>
                    <span class="display-4 fw-black">DH @Model.Course.Price</span>
                </div>

                <ul class="list-unstyled mb-4">
                    <li class="mb-3 d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-uppercase small text-muted"><i class="bi bi-calendar-event me-2"></i>Start Date</span>
                        <span class="fw-bold">@Model.Course.StartDate.ToString("MMM dd, yyyy")</span>
                    </li>
                    <li class="mb-3 d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-uppercase small text-muted"><i class="bi bi-clock me-2"></i>Duration</span>
                        <span class="fw-bold">4 Weeks</span>
                    </li>
                    <li class="mb-3 d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-uppercase small text-muted"><i class="bi bi-people me-2"></i>Capacity</span>
                        <span class="fw-bold">@Model.Course.Capacity Seats</span>
                    </li>
                    <li class="mb-3 d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-uppercase small text-muted"><i class="bi bi-translate me-2"></i>Language</span>
                        <span class="fw-bold">English</span>
                    </li>
                </ul>

                <button class="btn w-100 py-3 fw-black text-uppercase fs-5" 
                        style="background: #000; color: #fff; border: 2px solid #000; box-shadow: 4px 4px 0px #888;">
                    Enroll Now
                </button>
                
                <div class="text-center mt-3">
                    <small class="fw-bold text-muted">30-Day Money-Back Guarantee</small>
                </div>
            </div>
        </div>
    </div>
</div>
